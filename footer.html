<!--前のページ-->

<script type="text/javascript">
    // 現在のページが記事一覧の2ページ目以降の場合処理実行
    if (location.search.indexOf("?page=") === 0) {
        // aタグの作成
        var a = document.createElement('a');
        a.addEventListener("click", function(){history.back();}); // クリックすると一つ前の履歴に戻る処理を追加
        a.innerHTML = "前のページ"
        a.setAttribute("href", "javascript:void(0);");
        a.setAttribute("rel", "prev"); // seo対策
        // spanタグの作成（中に作成したaタグを入れる）
        var span = document.createElement('span');
        span.classList.add('pager-prev');
        span.appendChild(a);
        // classがpagerのdivタグに上記で作成したものを挿入する（classがpager-nextのspanタグよりも前に挿入する）
        var element = document.getElementsByClassName("pager")[0];
        element.insertBefore(span, element.firstChild);
    }
</script>

<!--スマホ検索バー-->
<script>
function toggleSearchBar() {
  const bar = document.getElementById('mobileSearchBar');
  const input = bar.querySelector('input[type="text"]');
  
  if (bar.classList.contains('active')) {
    bar.classList.remove('active');
  } else {
    bar.classList.add('active');
    setTimeout(() => {
      input.focus();
    }, 300); // 0.3秒待ってからフォーカス（CSSのスライドアニメに合わせる）
  }
}
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {

  // ====== 展開リスト開閉（player-toggle） ======
  const toggles = document.querySelectorAll('.player-toggle');
  toggles.forEach(function (toggle) {
    const sub = toggle.querySelector('.player-sub');
    toggle.addEventListener('click', function () {
      if (sub.style.maxHeight) {
        sub.style.maxHeight = null;
        sub.style.opacity = 0;
      } else {
        sub.style.maxHeight = sub.scrollHeight + 'px';
        sub.style.opacity = 1;
      }
    });
  });

  // ====== 凡例ボックス開閉（legend-box） ======
const legends = document.querySelectorAll('.legend-box, .filter-toggle');

legends.forEach(function (box) {
  const header = box.querySelector('.legend-header');
  const content = box.querySelector('.legend-content');

  // 初期状態（閉じておく）
  content.style.maxHeight = '0px';
  content.style.opacity = '0';
  content.style.marginBottom = '0';
  content.style.transition = 'max-height 0.4s ease, opacity 0.4s ease, margin 0.4s ease';

  const toggleLegend = () => {
    const isOpen = box.getAttribute('aria-expanded') === 'true';
    if (isOpen) {
      content.style.maxHeight = '0px';
      content.style.opacity = '0';
      content.style.marginBottom = '0';
      box.setAttribute('aria-expanded', 'false');
    } else {
      content.style.maxHeight = content.scrollHeight + 'px';
      content.style.opacity = '1';
      content.style.marginBottom = '0.5em';
      box.setAttribute('aria-expanded', 'true');
    }
  };

  header.addEventListener('click', function (e) {
    e.preventDefault();
    toggleLegend();
  });

  box.addEventListener('keydown', function (e) {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      toggleLegend();
    }
  });
});


  // ====== 年齢とNFL年数の自動計算 ======
  const today = new Date();
  const ages = document.querySelectorAll('.player-age');
  const years = document.querySelectorAll('.player-year');

  ages.forEach(function (el) {
    const birth = new Date(el.dataset.birthday);
    let age = today.getFullYear() - birth.getFullYear();
    const m = today.getMonth() - birth.getMonth();
    const d = today.getDate() - birth.getDate();
    if (m < 0 || (m === 0 && d < 0)) {
      age--;
    }
    const months = (today.getMonth() + (today.getDate() >= birth.getDate() ? 0 : -1) - birth.getMonth() + 12) % 12;
    const decimalAge = (age + months / 12).toFixed(1);
    const parts = decimalAge.split('.');
    el.innerHTML = parts[0] + '<span style="font-size: 80%;">.' + parts[1] + '</span>歳';
  });

  years.forEach(function (el) {
    const entryYear = parseInt(el.dataset.entry, 10);
    const exp = today.getFullYear() - entryYear;

    if (exp === 0) {
      el.innerHTML = '(R)'; // ルーキーの場合
    } else {
      el.innerHTML = `(${exp})`; // 経験年数
    }
  });

});

// =========スクロールスコア==========

  document.addEventListener("DOMContentLoaded", function() {
    const topButton = document.getElementById("scroll-top-button");
    if (topButton) {
      topButton.addEventListener("click", function () {
        window.scrollTo({
          top: 0,
          behavior: "smooth"
        });
      });
    }
  });
  
  document.addEventListener("DOMContentLoaded", function () {
  const slides = document.querySelectorAll(".schedule-slide");
  const carousel = document.querySelector(".schedule-carousel");
  let index = 0;
  let minDiff = Infinity;

  const today = new Date();

  slides.forEach((slide, i) => {
    const dateStr = slide.dataset.date;
    const date = new Date(dateStr);
    const diff = Math.abs(date - today);

    if (diff < minDiff) {
      minDiff = diff;
      index = i;
    }
  });

    function updateSlide() {
      const slideWidth = 200; // ← 固定値として指定
      const containerWidth = document.querySelector(".schedule-carousel-viewport").offsetWidth;
      const offset = -index * slideWidth + (containerWidth - slideWidth) / 2;
      document.querySelector(".schedule-carousel").style.transform = `translateX(${offset}px)`;
    }

  document.querySelector(".schedule-prev").addEventListener("click", () => {
    index = (index - 1 + slides.length) % slides.length;
    updateSlide();
  });

  document.querySelector(".schedule-next").addEventListener("click", () => {
    index = (index + 1) % slides.length;
    updateSlide();
  });

// スワイプ用変数
let touchStartX = 0;
let touchEndX = 0;

const viewport = document.querySelector(".schedule-carousel-viewport");

viewport.addEventListener("touchstart", (e) => {
  touchStartX = e.changedTouches[0].screenX;
});

viewport.addEventListener("touchend", (e) => {
  touchEndX = e.changedTouches[0].screenX;
  handleSwipe();
});

function handleSwipe() {
  const threshold = 30; // スワイプ判定の最小距離

  if (touchEndX < touchStartX - threshold) {
    index = (index + 1) % slides.length;
    updateSlide();
  } else if (touchEndX > touchStartX + threshold) {
    index = (index - 1 + slides.length) % slides.length;
    updateSlide();
  }
}


  setTimeout(updateSlide, 50);
});

// =========newsバー==========

  document.addEventListener("DOMContentLoaded", function () {
    const viewport = document.querySelector(".newsbar-b-viewport");
    const list = document.querySelector(".js-newsbar-b-list");
    if (!viewport || !list) return;

    // 元のHTMLを保存して、2回並べる（ニュース＋See More全部）
    const originalHTML = list.innerHTML;
    list.innerHTML = originalHTML + originalHTML;

    // 1セット分の幅（複製後の全体幅の半分）
    const originalWidth = list.scrollWidth / 2;

    // ★ ここが前に動いていた形：位置は x で管理
    let x = 0;
    const speed = 0.4; // 好みで 0.3〜0.6 あたりに調整

    let userInteracting = false;
    let resumeTimer = null;

    function animate() {
      if (!userInteracting) {
        x += speed;

        if (x >= originalWidth) {
          x -= originalWidth;
        }

        viewport.scrollLeft = x;
      }
      requestAnimationFrame(animate);
    }

    animate();

    function startInteraction() {
      userInteracting = true;
      if (resumeTimer) {
        clearTimeout(resumeTimer);
        resumeTimer = null;
      }
    }

    function endInteraction() {
      if (resumeTimer) {
        clearTimeout(resumeTimer);
      }
      // 触るのをやめて 1.5秒後に自動スクロール再開
      resumeTimer = setTimeout(function () {
    // ★ユーザーが止めた位置を現在位置として採用する
        x = viewport.scrollLeft;
        userInteracting = false;
      }, 1500);
    }


    // PC: スクロールし始めたら一時停止 → マウス離してちょっとしたら再開
    viewport.addEventListener("wheel", startInteraction, { passive: true });
    viewport.addEventListener("mouseleave", endInteraction, { passive: true });

    // スマホ: スワイプ中は一時停止、終わったら少しして再開
    viewport.addEventListener("touchstart", startInteraction, { passive: true });
    viewport.addEventListener("touchend", endInteraction, { passive: true });
    viewport.addEventListener("touchcancel", endInteraction, { passive: true });
  });

// ======戦績展開====== //
document.addEventListener("DOMContentLoaded", function () {
  const bar = document.getElementById("jax-record-bar");
  if (!bar) return;

  const btn = bar.querySelector(".jax-record-main");
  const details = bar.querySelector(".jax-record-details");
  if (!btn || !details) return;

  btn.addEventListener("click", function () {
    const isOpen = bar.classList.toggle("is-open");
    btn.setAttribute("aria-expanded", isOpen ? "true" : "false");
  });
});

</script>